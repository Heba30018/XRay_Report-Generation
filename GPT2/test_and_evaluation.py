# -*- coding: utf-8 -*-
"""Untitled38.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1MCC3Zu7w4GSrsE3IMnhfuzxNRIiOkjr-
"""

# Load data
val_df = pd.read_csv('val_df.csv')
val_ds = LoadDataset(val_df)

# Load model
model.eval()
for idx in range(40, 50):
    inputs = val_ds[idx]['pixel_values']
    with torch.no_grad():
        out = model.generate(inputs.unsqueeze(0).to('cuda'), num_beams=4, max_length=512)
    decoded_out = tokenizer.decode(out[0], skip_special_tokens=True)
    print(f"Prediction for index {idx}: {decoded_out}")
    plt.figure()
    plt.axis('off')
    plt.imshow(torch.permute(inputs, (1, 2, 0)))
    plt.show()
    print("\n\nActual Image and Text\n\n")
    labels_tensor = val_ds[idx]['labels']
    decoded_out = tokenizer.decode(labels_tensor, skip_special_tokens=True)
    print(decoded_out)
    inputs = val_ds[idx]['pixel_values']
    image_array = inputs.permute(1, 2, 0).numpy()
    plt.figure()
    plt.axis('off')
    plt.imshow(image_array)
    plt.show()